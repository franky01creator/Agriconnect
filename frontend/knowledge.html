<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agriconnect - Knowledge Hub</title>
    <style>
        /* |------------------------------------------------
        | GLOBAL / BASE STYLES 
        |------------------------------------------------
        */
        body { font-family: Arial, sans-serif; margin: 0; color: #333; line-height: 1.6; }

        /* Header Styling */
        .header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; background-color: #fff; border-bottom: 1px solid #eee; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05); }
        .header .logo { display: flex; align-items: center; font-size: 20px; font-weight: bold; color: #4CAF50; }
        .header .logo i { margin-right: 8px; font-size: 24px; }
        .nav-menu ul { list-style: none; margin: 0; padding: 0; display: flex; }
        .nav-menu li { margin-right: 30px; }
        .nav-menu a { text-decoration: none; color: #666; font-weight: 500; display: flex; align-items: center; padding-bottom: 5px; position: relative; transition: color 0.3s; }
        .nav-menu a:hover { color: #4CAF50; }
        .nav-menu i { margin-right: 8px; }
        .nav-menu li.active a { color: #4CAF50; font-weight: bold; }
        .user-actions { display: flex; align-items: center; }
        .user-actions a { text-decoration: none; color: #666; margin-left: 20px; display: flex; align-items: center; transition: color 0.3s; }
        .user-actions a:hover { color: #4CAF50; }

        /* Knowledge Hub Specifics */
        .knowledge-hero { background-color: #e8f5e9; padding: 60px 20px; text-align: center; }
        .hero-content h1 { color: #2e7d32; margin-bottom: 15px; font-size: 2.5rem; }
        .hero-content p { font-size: 1.2rem; margin-bottom: 25px; color: #555; max-width: 700px; margin: 0 auto; }
        .btn-hero { background-color: #4CAF50; color: white; border: none; padding: 12px 30px; border-radius: 5px; font-size: 1rem; cursor: pointer; transition: background-color 0.3s; }
        .btn-hero:hover { background-color: #45a049; }

        .knowledge-container { max-width: 1200px; margin: 40px auto; padding: 0 20px; }
        
        .search-filter-bar { display: flex; justify-content: space-between; margin-bottom: 30px; gap: 20px; }
        .search-input-wrapper { position: relative; flex: 1; max-width: 500px; }
        .search-input-wrapper i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #999; }
        .search-input-wrapper input { width: 100%; padding: 10px 10px 10px 40px; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; box-sizing: border-box; }
        .filter-dropdown select { padding: 10px 15px; border: 1px solid #ddd; border-radius: 5px; font-size: 1rem; background-color: white; cursor: pointer; }

        .knowledge-layout { display: grid; grid-template-columns: 2fr 1fr; gap: 30px; }
        .main-content-column { background-color: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); }
        .sidebar-column { background-color: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); align-self: start; }
        
        .section-heading { font-size: 1.5rem; color: #2e7d32; margin-top: 0; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid #eee; }
        
        .articles-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 40px; }
        .article-card { display: flex; border: 1px solid #eee; border-radius: 8px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; }
        .article-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1); }
        .article-img { flex: 0 0 100px; }
        .article-img img { width: 100%; height: 100%; object-fit: cover; }
        .article-details { flex: 1; padding: 15px; display: flex; flex-direction: column; justify-content: space-between; }
        .article-details h4 { margin: 0 0 10px 0; color: #333; font-size: 1.1rem; }
        .article-details p { color: #666; font-size: 0.9rem; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .btn-read-more { background-color: #4CAF50; color: white; border: none; padding: 8px 15px; border-radius: 4px; font-size: 0.9rem; cursor: pointer; align-self: flex-start; }
        
        /* Featured & Tips */
        .featured-card { border: 1px solid #eee; border-radius: 8px; overflow: hidden; margin-bottom: 25px; }
        .featured-header { display: flex; align-items: center; padding: 15px; background-color: #f9f9f9; border-bottom: 1px solid #eee; }
        .featured-header img { margin-right: 15px; border-radius: 5px; }
        .featured-header h4 { margin: 0 0 5px 0; color: #333; }
        .featured-header small { color: #666; }
        .featured-body { padding: 15px; }
        .btn-read-more-sm { background-color: #4CAF50; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 0.8rem; cursor: pointer; }
        
        .quick-tip-heading { font-size: 1.2rem; color: #2e7d32; margin-top: 30px; margin-bottom: 15px; }
        .quick-tip-card { display: flex; align-items: flex-start; padding: 15px; border: 1px solid #eee; border-radius: 8px; margin-bottom: 15px; background-color: #f9f9f9; }
        .tip-icon { flex: 0 0 30px; color: #ff9800; font-size: 1.2rem; margin-right: 10px; }
        .tip-text strong { display: block; margin-bottom: 5px; color: #333; }
        .tip-text p { margin: 0; color: #666; font-size: 0.9rem; }

        /* Modal Styles */
        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
        .modal-content { background-color: #fefefe; margin: 10% auto; padding: 30px; border: 1px solid #888; width: 60%; border-radius: 10px; position: relative; max-height: 70vh; overflow-y: auto; }
        .close-modal { color: #aaa; float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
        .close-modal:hover { color: black; }

        @media (max-width: 900px) {
            .knowledge-layout { grid-template-columns: 1fr; }
            .articles-grid { grid-template-columns: 1fr; }
            .search-filter-bar { flex-direction: column; }
            .modal-content { width: 90%; }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header class="header">
        <div class="logo">
            <i class="fas fa-leaf"></i> Agriconnect
        </div>
        <nav class="nav-menu">
            <ul>
                <li><a href="dashboard.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="marketplace.html"><i class="fas fa-store"></i> Marketplace</a></li>
                <li><a href="supplier-hub.html"><i class="fas fa-handshake"></i> Suppliers</a></li>
                <li><a href="message.html"><i class="fas fa-envelope"></i> Messages</a></li>
                <li class="active"><a href="#"><i class="fas fa-book"></i> Knowledge</a></li>
            </ul>
        </nav>
        <div class="user-actions">
            <a href="#"><i class="fas fa-user-circle"></i> <span id="userNameDisplay">Account</span></a>
            <a href="#" id="signOutBtn"><i class="fas fa-sign-out-alt"></i> Sign Out</a>
        </div>
    </header>

    <section class="knowledge-hero">
        <div class="hero-content">
            <h1>WELCOME TO THE KNOWLEDGE HUB</h1>
            <p>Your source for farming insights, supplier guides, and agricultural best practices.</p>
            <button class="btn-hero" onclick="document.querySelector('.search-input-wrapper input').focus()">Find Topics</button>
        </div>
    </section>

    <div class="knowledge-container">
        <div class="search-filter-bar">
            <div class="search-input-wrapper">
                <i class="fas fa-search"></i>
                <input type="text" id="searchInput" placeholder="Search articles, guides...">
            </div>
            <div class="filter-dropdown">
                <select id="categorySelect">
                    <option value="all">All Categories</option>
                    <option value="Soil Health">Soil Health</option>
                    <option value="Irrigation">Irrigation</option>
                    <option value="Pest Control">Pest Control</option>
                    <option value="Equipment">Equipment</option>
                    <option value="Business">Business</option>
                </select>
            </div>
        </div>

        <div class="knowledge-layout">
            <div class="main-content-column">
                <h3 class="section-heading">Latest Articles & Guides</h3>
                
                <div class="articles-grid" id="articlesContainer">
                    <p>Loading knowledge base...</p>
                </div>
            </div>

            <div class="sidebar-column">
                <h3 class="section-heading">Featured Content</h3>
                
                <div class="featured-card">
                    <div class="featured-header">
                        <img src="https://placehold.co/60x60/e8f5e9/2e7d32?text=News" alt="Featured">
                        <div>
                            <h4>Market Trends 2025</h4>
                            <small>Business Analysis</small>
                        </div>
                    </div>
                    <div class="featured-body">
                        <p>Discover the projected top-selling crops for the upcoming season based on global demand.</p>
                        <button class="btn-read-more-sm" onclick="openModal('Market Trends 2025', 'Full analysis of 2025 market trends would appear here...')">Read More</button>
                    </div>
                </div>

                <h4 class="quick-tip-heading">Quick Tips</h4>
                <div id="tipsContainer">
                    </div>
            </div>
        </div>
    </div>

    <div id="articleModal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modalTitle" style="color: #2e7d32;">Article Title</h2>
            <span id="modalCategory" style="background: #eee; padding: 4px 8px; border-radius: 4px; font-size: 0.8em;">Category</span>
            <div id="modalBody" style="margin-top: 20px; line-height: 1.8;">
                </div>
        </div>
    </div>

    <script>
        // --- MOCK DATA (Simulating a Database) ---
        const articlesDB = [
            {
                id: 1,
                title: "Sustainable Soil Management",
                category: "Soil Health",
                preview: "Techniques to maintain nutrient-rich soil for better crop yields using organic matter.",
                content: "Full article content about soil management would go here. It includes details on pH balancing, composting, and reducing tillage to preserve soil structure...",
                image: "Soil"
            },
            {
                id: 2,
                title: "Modern Irrigation Systems",
                category: "Irrigation",
                preview: "Comparing drip vs. sprinkler systems for cost efficiency and water conservation.",
                content: "This guide explores the ROI of drip irrigation systems versus traditional flood methods...",
                image: "Water"
            },
            {
                id: 3,
                title: "Organic Pest Control",
                category: "Pest Control",
                preview: "Natural remedies to keep your crops safe without harsh chemicals.",
                content: "Learn about neem oil, companion planting, and beneficial insects that can help control pests naturally...",
                image: "Pest"
            },
            {
                id: 4,
                title: "Tractor Maintenance 101",
                category: "Equipment",
                preview: "Essential checklist for maintaining heavy farm machinery.",
                content: "Regular maintenance schedules for oil changes, tire pressure checks, and hydraulic system inspections...",
                image: "Equip"
            },
            {
                id: 5,
                title: "Maximizing Profit Margins",
                category: "Business",
                preview: "How to price your produce effectively in local markets.",
                content: "Strategies for calculating cost of goods sold (COGS) and setting competitive prices...",
                image: "Biz"
            },
            {
                id: 6,
                title: "Winter Crop Planning",
                category: "Soil Health",
                preview: "Preparing your land for off-season growing or cover crops.",
                content: "Guide to selecting the best cover crops to fix nitrogen during the winter months...",
                image: "Winter"
            }
        ];

        const tipsDB = [
            { text: "Crop rotation can reduce soil erosion by up to 30%." },
            { text: "Testing soil pH levels annually saves fertilizer costs." },
            { text: "Drip irrigation is 90% more efficient than flood methods." }
        ];

        // --- AUTHENTICATION LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            const token = localStorage.getItem('authToken');
            const userStr = localStorage.getItem('user');

            if (!token || !userStr) {
                window.location.href = 'welcome.html';
                return;
            }

            if (userStr) {
                const user = JSON.parse(userStr);
                const nameDisplay = document.getElementById('userNameDisplay');
                if(nameDisplay) nameDisplay.textContent = user.firstName || 'Account';
            }

            // Sign Out
            document.getElementById('signOutBtn').addEventListener('click', (e) => {
                e.preventDefault();
                // Clear all user data including cart
                localStorage.removeItem('authToken');
                localStorage.removeItem('user');
                localStorage.removeItem('cart'); // Clear shopping cart
                window.location.href = 'welcome.html';
            });

            // Initial Render
            renderArticles(articlesDB);
            renderTips(tipsDB);
        });

        // --- SEARCH & FILTER LOGIC ---
        const searchInput = document.getElementById('searchInput');
        const categorySelect = document.getElementById('categorySelect');
        const articlesContainer = document.getElementById('articlesContainer');

        function filterContent() {
            const searchTerm = searchInput.value.toLowerCase();
            const selectedCategory = categorySelect.value;

            const filtered = articlesDB.filter(article => {
                const matchesSearch = article.title.toLowerCase().includes(searchTerm) || 
                                      article.preview.toLowerCase().includes(searchTerm);
                const matchesCategory = selectedCategory === 'all' || article.category === selectedCategory;
                
                return matchesSearch && matchesCategory;
            });

            renderArticles(filtered);
        }

        searchInput.addEventListener('input', filterContent);
        categorySelect.addEventListener('change', filterContent);

        // --- RENDERING FUNCTIONS ---
        function renderArticles(data) {
            articlesContainer.innerHTML = '';

            if (data.length === 0) {
                articlesContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No articles found matching your criteria.</p>';
                return;
            }

            data.forEach(article => {
                const card = document.createElement('div');
                card.className = 'article-card';
                card.innerHTML = `
                    <div class="article-img">
                        <img src="https://placehold.co/100x100/e8f5e9/2e7d32?text=${article.image}" alt="${article.title}">
                    </div>
                    <div class="article-details">
                        <div>
                            <h4>${article.title}</h4>
                            <span style="font-size: 0.8rem; color: #4CAF50; font-weight: bold;">${article.category}</span>
                            <p>${article.preview}</p>
                        </div>
                        <button class="btn-read-more" onclick="openArticle(${article.id})">Read More</button>
                    </div>
                `;
                articlesContainer.appendChild(card);
            });
        }

        function renderTips(tips) {
            const tipsContainer = document.getElementById('tipsContainer');
            tips.forEach(tip => {
                const tipCard = document.createElement('div');
                tipCard.className = 'quick-tip-card';
                tipCard.innerHTML = `
                    <div class="tip-icon"><i class="far fa-lightbulb"></i></div>
                    <div class="tip-text">
                        <strong>Did you know??</strong>
                        <p>${tip.text}</p>
                    </div>
                `;
                tipsContainer.appendChild(tipCard);
            });
        }

        // --- MODAL LOGIC ---
        const modal = document.getElementById('articleModal');
        const closeModal = document.querySelector('.close-modal');

        function openArticle(id) {
            const article = articlesDB.find(a => a.id === id);
            if (article) {
                document.getElementById('modalTitle').textContent = article.title;
                document.getElementById('modalCategory').textContent = article.category;
                document.getElementById('modalBody').textContent = article.content;
                modal.style.display = 'block';
            }
        }

        // Helper for the static featured article
        function openModal(title, content) {
             document.getElementById('modalTitle').textContent = title;
             document.getElementById('modalCategory').textContent = "Featured";
             document.getElementById('modalBody').textContent = content;
             modal.style.display = 'block';
        }

        closeModal.onclick = () => modal.style.display = 'none';
        window.onclick = (event) => {
            if (event.target === modal) modal.style.display = 'none';
        }
    </script>
</body>
</html>